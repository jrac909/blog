<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>什么是 SSR? | Jrac&#39;s 前端技术文档</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="imgs/home_home.png">
    <meta name="description" content="">
    
    <link rel="preload" href="/blog/assets/css/0.styles.dab10465.css" as="style"><link rel="preload" href="/blog/assets/js/app.d0cd04c6.js" as="script"><link rel="preload" href="/blog/assets/js/2.ab3d18b3.js" as="script"><link rel="preload" href="/blog/assets/js/36.1c4ead70.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.da15c793.js"><link rel="prefetch" href="/blog/assets/js/11.73da7b41.js"><link rel="prefetch" href="/blog/assets/js/12.4508db17.js"><link rel="prefetch" href="/blog/assets/js/13.e094c783.js"><link rel="prefetch" href="/blog/assets/js/14.d3441cb2.js"><link rel="prefetch" href="/blog/assets/js/15.ba762ceb.js"><link rel="prefetch" href="/blog/assets/js/16.c7c5cfb4.js"><link rel="prefetch" href="/blog/assets/js/17.589e1ac9.js"><link rel="prefetch" href="/blog/assets/js/18.74587141.js"><link rel="prefetch" href="/blog/assets/js/19.f6d88dc2.js"><link rel="prefetch" href="/blog/assets/js/20.55e5cb60.js"><link rel="prefetch" href="/blog/assets/js/21.916144e2.js"><link rel="prefetch" href="/blog/assets/js/22.8a05f14c.js"><link rel="prefetch" href="/blog/assets/js/23.3018200b.js"><link rel="prefetch" href="/blog/assets/js/24.e0e1af30.js"><link rel="prefetch" href="/blog/assets/js/25.0d24b0a7.js"><link rel="prefetch" href="/blog/assets/js/26.0c212d54.js"><link rel="prefetch" href="/blog/assets/js/27.54051f7c.js"><link rel="prefetch" href="/blog/assets/js/28.f142ed8f.js"><link rel="prefetch" href="/blog/assets/js/29.2ddf620c.js"><link rel="prefetch" href="/blog/assets/js/3.23f380c7.js"><link rel="prefetch" href="/blog/assets/js/30.df4f6778.js"><link rel="prefetch" href="/blog/assets/js/31.73afca0c.js"><link rel="prefetch" href="/blog/assets/js/32.48b9c904.js"><link rel="prefetch" href="/blog/assets/js/33.6c36ae22.js"><link rel="prefetch" href="/blog/assets/js/34.b94eff51.js"><link rel="prefetch" href="/blog/assets/js/35.2aaeee54.js"><link rel="prefetch" href="/blog/assets/js/37.d9f94543.js"><link rel="prefetch" href="/blog/assets/js/38.3e816bea.js"><link rel="prefetch" href="/blog/assets/js/39.81b702e1.js"><link rel="prefetch" href="/blog/assets/js/4.987baa04.js"><link rel="prefetch" href="/blog/assets/js/40.015849cd.js"><link rel="prefetch" href="/blog/assets/js/41.5567f825.js"><link rel="prefetch" href="/blog/assets/js/42.af93135d.js"><link rel="prefetch" href="/blog/assets/js/43.d964714b.js"><link rel="prefetch" href="/blog/assets/js/44.7e634282.js"><link rel="prefetch" href="/blog/assets/js/45.579e1b4f.js"><link rel="prefetch" href="/blog/assets/js/46.42996734.js"><link rel="prefetch" href="/blog/assets/js/47.10fe0064.js"><link rel="prefetch" href="/blog/assets/js/48.b1f0198b.js"><link rel="prefetch" href="/blog/assets/js/49.89b8323f.js"><link rel="prefetch" href="/blog/assets/js/5.d250cb53.js"><link rel="prefetch" href="/blog/assets/js/6.d7e152ce.js"><link rel="prefetch" href="/blog/assets/js/7.184419e9.js"><link rel="prefetch" href="/blog/assets/js/8.af0d9068.js"><link rel="prefetch" href="/blog/assets/js/9.083baca9.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.dab10465.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">Jrac's 前端技术文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/interview/question/01.html" class="nav-link">
  面试相关
</a></div><div class="nav-item"><a href="/blog/cicd/docker/DockerFile.html" class="nav-link">
  CICD
</a></div><div class="nav-item"><a href="/blog/basic/js/modularity.html" class="nav-link">
  Basic
</a></div><div class="nav-item"><a href="/blog/UI/elementui/main.html" class="nav-link">
  UI
</a></div><div class="nav-item"><a href="/blog/server/node/node_basic.html" class="nav-link">
  Server
</a></div><div class="nav-item"><a href="/blog/framework/vue/ssr.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Framework
</a></div><div class="nav-item"><a href="/blog/else/monorepo/main.html" class="nav-link">
  Else
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/interview/question/01.html" class="nav-link">
  面试相关
</a></div><div class="nav-item"><a href="/blog/cicd/docker/DockerFile.html" class="nav-link">
  CICD
</a></div><div class="nav-item"><a href="/blog/basic/js/modularity.html" class="nav-link">
  Basic
</a></div><div class="nav-item"><a href="/blog/UI/elementui/main.html" class="nav-link">
  UI
</a></div><div class="nav-item"><a href="/blog/server/node/node_basic.html" class="nav-link">
  Server
</a></div><div class="nav-item"><a href="/blog/framework/vue/ssr.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Framework
</a></div><div class="nav-item"><a href="/blog/else/monorepo/main.html" class="nav-link">
  Else
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Vue</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/framework/vue/ssr.html" aria-current="page" class="active sidebar-link">SSR 服务端渲染</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/framework/vue/ssr.html#什么是-ssr" class="sidebar-link">什么是 SSR?</a></li><li class="sidebar-sub-header"><a href="/blog/framework/vue/ssr.html#为什么要用-ssr" class="sidebar-link">为什么要用 SSR？</a></li><li class="sidebar-sub-header"><a href="/blog/framework/vue/ssr.html#ssr-vs-ssg" class="sidebar-link">SSR vs. SSG?</a></li><li class="sidebar-sub-header"><a href="/blog/framework/vue/ssr.html#基础教程" class="sidebar-link">基础教程</a></li><li class="sidebar-sub-header"><a href="/blog/framework/vue/ssr.html#客户端激活" class="sidebar-link">客户端激活</a></li><li class="sidebar-sub-header"><a href="/blog/framework/vue/ssr.html#遵循原则" class="sidebar-link">遵循原则</a></li></ul></li><li><a href="/blog/framework/vue/vuepress.html" class="sidebar-link">VuePress 使用教程</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="什么是-ssr"><a href="#什么是-ssr" class="header-anchor">#</a> 什么是 SSR?</h2> <p>  指在服务端（<code>nodejs server</code>）完成页面 html 拼接（<code>包括一些初始数据的查询</code>），然后再发送给浏览器，此时的 html 并未绑定事件，也没有相关的状态，所以需要在客户端进行<code>“激活”</code>，使其成为能够交互的客户端应用。</p> <div class="custom-block tip"><p class="custom-block-title">补充</p> <p>  应用的大部分代码同时运行在服务端和客户端：服务端需要解析拼接整个页面，所以肯定要有相关代码的，包括初始数据的请求，路由、状态管理等；客户端要保证用户的交互，所以肯定也需要有页面的代码，还有相关的事件操作等等。</p> <p>  为什么服务端可以解析，在学 vue 的时候就能了解到，vue 是基于 VNode 虚拟 Dom 的，它的一个大优势就是跨平台。</p></div> <h2 id="为什么要用-ssr"><a href="#为什么要用-ssr" class="header-anchor">#</a> 为什么要用 SSR？</h2> <p>  这里可以从前端开发模式的变更说起，最开始的应用，前后端不分离，服务器直接返回渲染好的 html 文档，前端可以在页面上进行很多操作，状态可以从 session 获取，这样处理前端渲染更快， SEO 友好，但是前端工作不明确，代码结构不清晰，开发效率低，前端也要了解一些后端基础，基于这个情况，出现了前后端分离。</p> <p>  前端单独开启一个服务，独立开发，渲染页面，通过 ajax 等技术仅与后端进行数据交换。但是这样产生了新的问题，比如 vue，初始 html 只有一个容器 div，需要下载 vuejs 对 template 模板进行渲染后，包括数据请求后，才能看到完整的页面，这导致 SEO 失效，另一方面，下载内容过多，首屏渲染过慢。</p> <p>  服务端渲染除了最早期的服务端开发模式，优势在于：</p> <ul><li>可以使用前端语言，node 的语言也是 js，而不需要去学 java</li> <li>仍然具有前后端分离的优势</li></ul> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>使用 ssr 开发有更多的限制：</p> <ul><li>服务端只会执行 create 两个钩子，所以一些第三方库代码依赖其他钩子，服务端无法执行，需要做特殊处理</li> <li>因为依赖于 node，所以部署的时候需要在服务器上安装 node</li> <li>更高的服务端负载，采用合理的缓存策略（<code>lru-cache</code>）</li></ul></div> <h2 id="ssr-vs-ssg"><a href="#ssr-vs-ssg" class="header-anchor">#</a> SSR vs. SSG?</h2> <p><strong>SSG</strong>主要是指渲染提前渲染好静态页面由服务器托管，其中一个特性就是，对所有用户返回的页面是相同的，不存在状态管理。所以像一些教程文档、宣传页就更适合 SSG。</p> <h2 id="基础教程"><a href="#基础教程" class="header-anchor">#</a> 基础教程</h2> <blockquote><p>参考官方文档：https://staging-cn.vuejs.org/guide/scaling-up/ssr.html#ssr-vs-ssg</p></blockquote> <ol><li>创建新的项目文件夹并且进入文件夹: <code>mkdir demo</code> <code>cd demo</code></li> <li><code>npm init -y</code>：采用默认初始化项目配置，其实就是生成 package.json,也可以在这里自定义项目信息</li> <li>在 package.json 中添加 &quot;type&quot;: &quot;module&quot;,使 nodejs 以 ES modules mode 运行：这个其实并不是一定要配置的，这个配置是什么意思呢，可以去看一看 node 的文档，node 默认采用 commonjs 模块化，所以我们引入都是 require,这个配置就是开启 es module 模块化，也就是 import 引入库。但是需要注意，这两者是二选一的关系。（如果要对照文档的引入来写，就需要改这个配置，只是说实际项目中，这个不是必要的配置。）</li> <li>执行 <code>npm install vue</code>：基于 vue 开发，这个肯定是必要的库</li> <li>创建一个 server.js 文件：</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 此文件运行在 Node.js 服务器上</span>
<span class="token comment">// 这个方法主要是创建一个 vue 实例</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createSSRApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> renderToString <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue/server-renderer'</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">createSSRApp</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">data</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;button @click=&quot;count++&quot;&gt;{{ count }}&lt;/button&gt;</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// renderToString 方法接收 vue 实例作为参数,将 vue 实例编译成 html 静态串</span>
<span class="token function">renderToString</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">html</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ol start="6"><li>运行 example.js：<code>node server.js</code></li></ol> <p>  上述 1-6 步在服务端将 vue 实例编译成 html 串,要实现服务器渲染,我们还需要：1.开启一个 node 服务;2.拼接完整的 html 串,可以看到上面生成的 html 只包括内容部分,还需要 html head body 等标签,我们需要将其补充完整。</p> <ol><li>使用 express 开启服务(先安装 express:<code>npm install express</code>)：</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> express <span class="token keyword">from</span> <span class="token string">'express'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createSSRApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> renderToString <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue/server-renderer'</span>

<span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

server<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">createSSRApp</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function-variable function">data</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;button @click=&quot;count++&quot;&gt;{{ count }}&lt;/button&gt;</span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">renderToString</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">html</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    &lt;!DOCTYPE html&gt;
    &lt;html&gt;
      &lt;head&gt;
        &lt;title&gt;Vue SSR Example&lt;/title&gt;
      &lt;/head&gt;
      &lt;body&gt;
        &lt;div id=&quot;app&quot;&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>html<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/div&gt;
      &lt;/body&gt;
    &lt;/html&gt;
    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ready'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ol start="2"><li>执行 <code>node server.js</code></li> <li>访问 http://localhost:3000</li></ol> <div class="custom-block danger"><p class="custom-block-title">注意</p> <p>这时候点击按钮是没有效果的，回忆一下最开始说的，服务端返回静态 html 串，server.js 在服务端执行，客户端甚至连 vue 都没有引入，所以需要客户端激活，在客户端绑定事件等。</p></div> <h2 id="客户端激活"><a href="#客户端激活" class="header-anchor">#</a> 客户端激活</h2> <h3 id="怎么激活"><a href="#怎么激活" class="header-anchor">#</a> 怎么激活？</h3> <p>  创建一个和服务端完全相同的应用实例，也就是说 options 是完全一致的，既然如此，为了避免服务端客户端两边不一致，我们最好写一个公共的创建实例的方法，我们可以创建一个 app.js 文件，在其中实现创建 vue 实例的工厂函数，并 export 导出，提供给服务端和客户端使用。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// app.js (在服务器和客户端之间共享)</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createSSRApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">createSSRApp</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function-variable function">data</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;button @click=&quot;count++&quot;&gt;{{ count }}&lt;/button&gt;</span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>  然后在客户端创建实例并挂载：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// client.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./app.js'</span>

<span class="token function">createApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>
</code></pre></div><p>  将服务端的 createSSRApp 同样替换为这个公用方法创建实例。</p> <p><strong>这时候还有什么问题？</strong></p> <ol><li>服务端返回的 html 没有变化, 我们写了 client.js 是用来激活的，但是怎么执行它呢</li> <li>这个 client.js 依赖于 vue, 那我们是不是还应该引入 vue? 怎么引入呢?</li></ol> <p>  不需要考虑的太复杂,想一想浏览器是怎样执行 js 文件的,要么直接写在 script 标签中,要么直接通过标签引入,这里肯定是标签引入 client.js 文件了。既然依赖于 vue,那在这前面再引入 vue 就好了,所以直接在 server.js 的 html 串加上引用</p> <div class="language-html extra-class"><pre class="language-html"><code>renderToString(app).then((html) =&gt; {
    res.send(`
    <span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Vue SSR Example<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>importmap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
          <span class="token punctuation">{</span>
            <span class="token string-property property">&quot;imports&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token string-property property">&quot;vue&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://unpkg.com/vue@3/dist/vue.esm-browser.js&quot;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/client.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>${html}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
    `)
  })
</code></pre></div><p>现在再执行 node server.js 就没问题了</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>以上只是一个最基础的例子,主要为了讲解大致流程,在实际项目中我们还需要考虑更多的问题,比如路由控制、状态管理,我们可以自己实现配置,也可以直接使用一些插件,比如 nuxt。</p></div> <h2 id="遵循原则"><a href="#遵循原则" class="header-anchor">#</a> 遵循原则</h2> <p>无论是选择自己配置,还是使用框架,都需要遵循以下原则。</p> <h3 id="服务端的响应性"><a href="#服务端的响应性" class="header-anchor">#</a> 服务端的响应性</h3> <p>浏览器每一个请求url,返回的是一个生成好的 html,不包括用户的交互,服务端不需要处理用户交互也不需要更新DOM,所以服务端是禁用响应性的</p> <h3 id="生命周期"><a href="#生命周期" class="header-anchor">#</a> 生命周期</h3> <p>既然服务端没有响应式也没有 $mount 挂载,那它自然不需要执行 mounte 和 update 阶段钩子,事实上确实没有,所以我们应该避免在 create 创建的东西,在 unmount 清除,比如定时器,create 两边都创建,但是 unmount 只在客户端清除,那服务端就一直保留了,所以这种代码最好放在 mount 执行</p> <h3 id="访问平台特有-api"><a href="#访问平台特有-api" class="header-anchor">#</a> 访问平台特有 api</h3> <p>比如 window 和 document 是浏览器的变量，那肯定没法在 create 阶段操作 window，因为服务端会执行，找不到就会报错，反过来也一样。</p> <h3 id="跨请求状态污染"><a href="#跨请求状态污染" class="header-anchor">#</a> 跨请求状态污染</h3> <p>先看了引入 vuex 再讲这一部分吧。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/blog/framework/vue/vuepress.html">
        VuePress 使用教程
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.d0cd04c6.js" defer></script><script src="/blog/assets/js/2.ab3d18b3.js" defer></script><script src="/blog/assets/js/36.1c4ead70.js" defer></script>
  </body>
</html>
